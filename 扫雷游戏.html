<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>æ‰«é›·æ¸¸æˆ</title>
    <link rel="icon" href="https://user-assets.sxlcdn.com/images/1209238/FlWuslNmGTHt1EipxUtq2GI6zqnN.png?imageMogr2/strip/auto-orient/thumbnail/1200x9000%3E/quality/90!/format/png" type="image/png" />
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #game {
            display: grid;
            grid-template-rows: repeat(9, 40px);
            grid-template-columns: repeat(9, 40px);
            gap: 5px;
            perspective: 1000px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: #2c3e50;
            border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.2s, background 0.3s;
        }
        .cell:hover { transform: scale(1.1); background: #34495e; }
        .cell.revealed {
            background: #bdc3c7;
            cursor: default;
            transform: rotateY(0deg);
            transition: transform 0.5s, background 0.5s;
            font-weight: bold;
            font-size: 20px;
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .content { color: inherit; }
        .cell.flagged { background: #e74c3c; color: #fff; }

        #reset {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background: #3498db;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
        }
        #reset:hover { background: #2980b9; transform: scale(1.05); }
        #reset:active { background: #1c5980; transform: scale(0.95); }

        /* Mine and Flag Icons */
        .mine::before { content: 'ğŸ’£'; font-size: 24px; }
        .flag::before { content: 'ğŸš©'; font-size: 24px; }

        /* å¼¹çª—æ ·å¼ç¾åŒ– */
        #modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex; /* åˆæ¬¡è¿›å…¥å³æ˜¾ç¤ºï¼ˆæ— å‰å‰ï¼‰ */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #modalContent {
            background: #fff;
            color: #333;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            animation: modalAppear 0.5s ease-out;
            position: relative; /* ä¸ºå³ä¸Šè§’å‰å‰å®šä½ */
        }
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #modalContent input {
            width: 100%;
            padding: 10px;
            margin: 15px 0;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 6px;
            transition: border-color 0.3s;
        }
        #modalContent input:focus { border-color: #3498db; outline: none; }
        .modalButtons button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            transition: background 0.3s, transform 0.2s;
        }
        .modalButtons button#setupBtn { background: #2ecc71; color: #fff; }
        .modalButtons button#setupBtn:hover { background: #27ae60; }
        .modalButtons button#defaultBtn { background: #3498db; color: #fff; }
        .modalButtons button#defaultBtn:hover { background: #2980b9; }

        /* â˜… å³ä¸Šè§’å‰å‰æŒ‰é’®ï¼ˆé»˜è®¤éšè—ï¼›ä»…â€œé‡æ–°å¼€å§‹â€æ—¶æ˜¾ç¤ºï¼‰ */
        .modalClose {
            position: absolute;
            top: 10px; right: 12px;
            font-size: 22px;
            line-height: 22px;
            width: 28px; height: 28px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #999;
            cursor: pointer;
            display: none; /* å…³é”®ï¼šåˆæ¬¡è¿›å…¥ä¸æ˜¾ç¤º */
        }
        .modalClose:hover { color: #333; transform: scale(1.05); }
        .modalClose:active { transform: scale(0.95); }
        .modalClose.visible { display: inline-block; } /* é€šè¿‡æ·»åŠ æ­¤ç±»æ¥æ˜¾ç¤ºå‰å‰ */
    </style>
</head>
<body>
    <h1>æ‰«é›·æ¸¸æˆ</h1>

    <!-- å¼¹çª—ï¼šè®¾ç½®é›·æ•° -->
    <div id="modal">
        <div id="modalContent">
            <!-- â˜… å³ä¸Šè§’å…³é—­æŒ‰é’®ï¼ˆé»˜è®¤ä¸æ˜¾ç¤ºï¼Œé€šè¿‡JSåœ¨â€œé‡æ–°å¼€å§‹â€æ—¶æ·»åŠ  .visible ç±»ï¼‰ -->
            <button id="closeModal" class="modalClose" aria-label="å…³é—­è®¾ç½®çª—å£" title="å…³é—­">Ã—</button>

            <h2>è®¾ç½®é›·æ•°</h2>
            <p>è¯·è¾“å…¥é›·æ•°ï¼š</p>
            <input type="number" id="mineInput" min="1" placeholder="é›·æ•°" />
            <div class="modalButtons">
                <button id="setupBtn">å®Œæˆè®¾ç½®</button>
                <button id="defaultBtn">ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆ10ä¸ªé›·ï¼‰</button>
            </div>
        </div>
    </div>

    <div id="game"></div>
    <button id="reset">é‡æ–°å¼€å§‹</button>

    <script>
        const ROWS = 9;
        const COLS = 9;
        let MINES; // é›·æ•°å°†åœ¨å¼¹çª—ä¸­è®¾ç½®

        let grid = [];
        let mineLocations = [];
        let revealedCount = 0;
        let flags = 0;
        let gameOver = false;
        let firstClick = true; // ç¬¬ä¸€æ¬¡ç‚¹å‡»æ ‡å¿—

        const gameContainer = document.getElementById('game');
        const resetButton = document.getElementById('reset');

        function init() {
            grid = [];
            mineLocations = [];
            revealedCount = 0;
            flags = 0;
            gameOver = false;
            firstClick = true;
            gameContainer.innerHTML = '';

            // åˆ›å»ºç½‘æ ¼
            for (let r = 0; r < ROWS; r++) {
                const row = [];
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    // åˆ›å»ºå†…å®¹å±‚
                    const content = document.createElement('div');
                    content.classList.add('content');
                    cell.appendChild(content);

                    cell.addEventListener('click', onCellClick);
                    cell.addEventListener('contextmenu', onCellRightClick);
                    gameContainer.appendChild(cell);
                    row.push({
                        isMine: false,
                        revealed: false,
                        flagged: false,
                        adjacentMines: 0
                    });
                }
                grid.push(row);
            }
        }

        function placeMines(excludeR, excludeC) {
            mineLocations = [];
            let minesPlaced = 0;
            while (minesPlaced < MINES) {
                const r = Math.floor(Math.random() * ROWS);
                const c = Math.floor(Math.random() * COLS);
                // ç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®ä¸ç”Ÿæˆåœ°é›·
                if (!grid[r][c].isMine && !(r === excludeR && c === excludeC)) {
                    grid[r][c].isMine = true;
                    mineLocations.push({ r, c });
                    minesPlaced++;
                }
            }
            // è®¡ç®—ç›¸é‚»é›·æ•°
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (!grid[r][c].isMine) {
                        grid[r][c].adjacentMines = countAdjacentMines(r, c);
                    }
                }
            }
        }

        function countAdjacentMines(r, c) {
            let count = 0;
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    const nr = r + dr;
                    const nc = c + dc;
                    if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && grid[nr][nc].isMine) count++;
                }
            }
            return count;
        }

        function onCellClick(e) {
            if (gameOver) return;
            const cell = e.currentTarget;
            const r = parseInt(cell.dataset.row);
            const c = parseInt(cell.dataset.col);

            if (firstClick) {
                placeMines(r, c);
                firstClick = false;
            }

            revealCell(r, c);
            checkWin();
        }

        function onCellRightClick(e) {
            e.preventDefault();
            if (gameOver) return;
            const cell = e.currentTarget;
            const r = parseInt(cell.dataset.row);
            const c = parseInt(cell.dataset.col);
            toggleFlag(r, c);
        }

        function revealCell(r, c) {
            const cellData = grid[r][c];
            const cell = getCellElement(r, c);
            const content = cell.querySelector('.content');

            if (cellData.revealed || cellData.flagged) return;

            cellData.revealed = true;
            cell.classList.add('revealed');

            if (cellData.isMine) {
                content.classList.add('mine');
                cell.style.backgroundColor = '#e74c3c';
                gameOver = true;
                revealAllMines();
                showMineLocations();
                alert('æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°åœ°é›·äº†ã€‚');
            } else {
                revealedCount++;
                if (cellData.adjacentMines > 0) {
                    content.textContent = cellData.adjacentMines;
                    content.style.color = getColor(cellData.adjacentMines);
                } else {
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            const nr = r + dr;
                            const nc = c + dc;
                            if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                                if (!grid[nr][nc].revealed) revealCell(nr, nc);
                            }
                        }
                    }
                }
            }
        }

        function toggleFlag(r, c) {
            const cellData = grid[r][c];
            const cell = getCellElement(r, c);
            const content = cell.querySelector('.content');

            if (cellData.revealed) return;

            cellData.flagged = !cellData.flagged;
            if (cellData.flagged) {
                cell.classList.add('flagged');
                content.classList.add('flag');
                flags++;
            } else {
                cell.classList.remove('flagged');
                content.classList.remove('flag');
                flags--;
            }
        }

        function getCellElement(r, c) {
            return gameContainer.children[r * COLS + c];
        }

        function revealAllMines() {
            mineLocations.forEach(({ r, c }) => {
                const cell = getCellElement(r, c);
                const content = cell.querySelector('.content');
                if (!grid[r][c].revealed) {
                    cell.classList.add('revealed');
                    content.classList.add('mine');
                    cell.style.backgroundColor = '#e74c3c';
                }
            });
        }

        function showMineLocations() {
            const locations = mineLocations.map(({ r, c }) => `(${r + 1}, ${c + 1})`).join(', ');
            alert(`åœ°é›·ä½ç½®: ${locations}`);
        }

        function checkWin() {
            if (revealedCount === ROWS * COLS - MINES) {
                gameOver = true;
                alert('æ­å–œä½ ï¼Œèµ¢äº†ï¼');
                revealAllMines();
            }
        }

        function getColor(number) {
            const colors = {
                1: '#3498db',
                2: '#2ecc71',
                3: '#e74c3c',
                4: '#9b59b6',
                5: '#f1c40f',
                6: '#1abc9c',
                7: '#34495e',
                8: '#7f8c8d'
            };
            return colors[number] || '#2c3e50';
        }

        // ===== å¼¹çª—é€»è¾‘ï¼ˆå«â€œåªåœ¨é‡æ–°å¼€å§‹æ—¶æ˜¾ç¤ºå‰å‰â€ï¼‰ =====
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modalContent');
        const setupBtn = document.getElementById('setupBtn');
        const defaultBtn = document.getElementById('defaultBtn');
        const mineInput = document.getElementById('mineInput');
        const closeModalBtn = document.getElementById('closeModal');

        // åˆæ¬¡è¿›å…¥ï¼šæ˜¾ç¤ºå¼¹çª—ï¼Œä½†ä¸æ˜¾ç¤ºå³ä¸Šè§’å‰å‰
        closeModalBtn.classList.remove('visible');

        setupBtn.addEventListener('click', () => {
            const value = parseInt(mineInput.value);
            if (!isNaN(value) && value > 0 && value < ROWS * COLS) {
                MINES = value;
                modal.style.display = 'none';
                init();
            } else {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é›·æ•° (1 åˆ° " + (ROWS * COLS - 1) + ")");
            }
        });

        defaultBtn.addEventListener('click', () => {
            MINES = 10;
            modal.style.display = 'none';
            init();
        });

        // â˜… ç‚¹å‡»â€œé‡æ–°å¼€å§‹â€ï¼šæ‰“å¼€å¼¹çª—ï¼Œå¹¶æ˜¾ç¤ºå³ä¸Šè§’å‰å‰
        resetButton.addEventListener('click', () => {
            modal.style.display = 'flex';
            closeModalBtn.classList.add('visible'); // åªåœ¨é‡æ–°å¼€å§‹æ—¶æ˜¾ç¤º
            mineInput.value = ''; // æ¸…ç©ºä¸Šæ¬¡è¾“å…¥
            mineInput.focus();
        });

        // â˜… å³ä¸Šè§’å‰å‰ï¼šä»…å½“å¯è§æ—¶å¯å…³é—­å¼¹çª—ï¼ˆä¸æ”¹å˜å½“å‰å±€é¢ï¼‰
        closeModalBtn.addEventListener('click', () => {
            if (closeModalBtn.classList.contains('visible')) {
                modal.style.display = 'none';
            }
        });

        // å¯é€‰ï¼šç‚¹å‡»é®ç½©ä¸å…³é—­ï¼Œé˜²è¯¯è§¦ï¼›å¦‚éœ€ç‚¹å‡»ç©ºç™½å…³é—­ï¼Œå¯è§£é™¤æ³¨é‡Š
        // modal.addEventListener('click', (e) => {
        //     if (e.target === modal && closeModalBtn.classList.contains('visible')) {
        //         modal.style.display = 'none';
        //     }
        // });

        // å¯é€‰ï¼šEsc å…³é—­ï¼ˆä»…â€œé‡æ–°å¼€å§‹â€æ¨¡å¼ä¸”å‰å‰å¯è§æ—¶ï¼‰
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display !== 'none' && closeModalBtn.classList.contains('visible')) {
                modal.style.display = 'none';
            }
        });
    </script>
</body>
</html>