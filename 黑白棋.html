<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黑白棋【双人版】</title>
    <link
        rel="icon"
        href="https://user-assets.sxlcdn.com/images/1209238/FlWuslNmGTHt1EipxUtq2GI6zqnN.png?imageMogr2/strip/auto-orient/thumbnail/1200x9000%3E/quality/90!/format/png"
        type="image/png"
    />
    <style>
        :root {
            --cell-size: min(10vw, 50px);
            --board-padding: min(2vw, 10px);
            --shadow: 0 4px 20px rgba(0,0,0,0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #f0f0f0 0%, #d0d0d0 100%);
            padding: 10px;
            box-sizing: border-box;
        }

        .game-container {
            text-align: center;
            background: white;
            padding: clamp(15px, 5vw, 30px);
            border-radius: 15px;
            box-shadow: var(--shadow);
            max-width: 90vw;
            width: 100%;
        }

        h1 {
            margin: 0 0 15px;
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 0.2vmin;
            background: linear-gradient(45deg, #228B22, #006400);
            padding: var(--board-padding);
            border-radius: 10px;
            margin: 20px auto;
            width: min(80vw, 400px);
            aspect-ratio: 1;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3), var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 3px
            ), repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 3px
            );
            pointer-events: none;
            z-index: 1;
        }

        .board.game-over .cell {
            cursor: not-allowed;
        }

        .cell {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #A0522D, #8B4513);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
            z-index: 2;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .cell:hover:not(.game-over):not(.valid) {
            transform: scale(1.02) rotate(1deg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .cell.valid {
            background: linear-gradient(145deg, rgba(0,255,0,0.2), rgba(0,150,0,0.1));
            border: 2px solid rgba(0,255,0,0.6);
            box-shadow: 0 0 20px rgba(0,255,0,0.4), inset 0 0 10px rgba(0,255,0,0.1);
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px rgba(0,255,0,0.3), inset 0 0 5px rgba(0,255,0,0.05); }
            100% { box-shadow: 0 0 30px rgba(0,255,0,0.6), inset 0 0 15px rgba(0,255,0,0.15); }
        }

        .piece {
            width: 85%;
            height: 85%;
            border-radius: 50%;
            position: absolute;
            transition: var(--transition);
            box-shadow: var(--shadow), inset 0 2px 4px rgba(255,255,255,0.3);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }

        .piece.black {
            background: linear-gradient(145deg, #000, #333);
            box-shadow: var(--shadow), 0 0 10px rgba(0,0,0,0.5), inset 0 2px 4px rgba(255,255,255,0.1);
        }

        .piece.white {
            background: linear-gradient(145deg, #fff, #f0f0f0);
            box-shadow: var(--shadow), 0 0 10px rgba(255,255,255,0.5), inset 0 -2px 4px rgba(0,0,0,0.1);
        }

        .piece.flip {
            animation: flip 0.6s ease-in-out;
        }

        @keyframes flip {
            0% { 
                transform: rotateY(0deg) scale(1); 
                opacity: 1;
            }
            50% { 
                transform: rotateY(90deg) scale(0.8); 
                opacity: 0.5;
            }
            100% { 
                transform: rotateY(180deg) scale(1); 
                opacity: 1;
            }
        }

        .piece.appear {
            animation: appear 0.4s ease-out;
        }

        @keyframes appear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(0deg); opacity: 0.7; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .status {
            font-size: clamp(1rem, 3vw, 1.2rem);
            margin: 15px 0;
            color: #333;
            font-weight: bold;
        }

        .player {
            color: #333;
        }

        .current {
            color: #1e90ff;
            text-shadow: 0 0 5px rgba(30,144,255,0.5);
        }

        .winner {
            color: #ff4500;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            animation: celebrate 0.5s ease-in-out infinite alternate;
        }

        .scores {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        }

        .score {
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(0,0,0,0.05);
        }

        .black-score {
            color: #000;
            font-weight: bold;
        }

        .white-score {
            color: #fff;
            background: #000;
            font-weight: bold;
        }

        @keyframes celebrate {
            0% { transform: scale(1); text-shadow: 0 0 5px rgba(255,69,0,0.5); }
            100% { transform: scale(1.05); text-shadow: 0 0 15px rgba(255,69,0,0.8); }
        }

        button {
            padding: clamp(8px, 2vw, 12px) clamp(15px, 4vw, 25px);
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        button:hover {
            background: linear-gradient(145deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(76,175,80,0.4);
        }

        button:active {
            transform: translateY(0);
        }

        @media (max-width: 480px) {
            :root {
                --cell-size: 8vw;
            }
            .game-container {
                padding: 10px;
                border-radius: 10px;
            }
            h1 {
                margin-bottom: 10px;
            }
            .scores {
                gap: 10px;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>黑白棋 (Reversi)</h1>
        <div class="scores" id="scores">
            <span class="score black-score">黑: 2</span>
            <span class="score white-score">白: 2</span>
        </div>
        <div class="status">
            <span class="player current" id="currentPlayer">黑方</span> 的回合
        </div>
        <div class="board" id="board"></div>
        <div>
            <button onclick="resetGame()">重新开始</button>
        </div>
    </div>

    <script>
        const BOARD_SIZE = 8;
        let board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(0));
        let currentPlayer = 1; // 1: black, -1: white
        let gameOver = false;
        const directions = [
            [-1, -1], [-1, 0], [-1, 1],
            [0, -1],           [0, 1],
            [1, -1],  [1, 0],  [1, 1]
        ];

        // 计算棋子数量
        function countPieces() {
            let blackCount = 0;
            let whiteCount = 0;
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if (board[row][col] === 1) blackCount++;
                    else if (board[row][col] === -1) whiteCount++;
                }
            }
            return { blackCount, whiteCount };
        }

        // 初始化棋盘
        function initBoard() {
            board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(0));
            board[3][3] = -1;
            board[3][4] = 1;
            board[4][3] = 1;
            board[4][4] = -1;
            currentPlayer = 1;
            gameOver = false;
            renderBoard();
            highlightValidMoves();
            updateStatus();
        }

        // 渲染棋盘
        function renderBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    if (!gameOver) {
                        cell.onclick = () => makeMove(row, col);
                    }

                    const piece = document.createElement('div');
                    piece.className = 'piece';
                    if (board[row][col] === 1) {
                        piece.classList.add('black');
                    } else if (board[row][col] === -1) {
                        piece.classList.add('white');
                    }
                    cell.appendChild(piece);

                    boardEl.appendChild(cell);
                }
            }
            if (gameOver) {
                boardEl.classList.add('game-over');
            } else {
                boardEl.classList.remove('game-over');
            }
        }

        // 检查是否有有效移动
        function hasValidMoves(player) {
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if (isValidMove(row, col, player)) {
                        return true;
                    }
                }
            }
            return false;
        }

        // 高亮有效移动
        function highlightValidMoves() {
            if (gameOver) return;
            document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('valid'));
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if (board[row][col] === 0 && isValidMove(row, col, currentPlayer)) {
                        const cellEl = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        if (cellEl) {
                            cellEl.classList.add('valid');
                        }
                    }
                }
            }
        }

        // 检查有效移动
        function isValidMove(row, col, player) {
            if (board[row][col] !== 0 || gameOver) return false;
            for (let [dr, dc] of directions) {
                let r = row + dr;
                let c = col + dc;
                let foundOpponent = false;
                while (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_SIZE) {
                    if (board[r][c] === 0) break;
                    if (board[r][c] === player) {
                        if (foundOpponent) return true;
                        break;
                    }
                    if (board[r][c] === -player) {
                        foundOpponent = true;
                    }
                    r += dr;
                    c += dc;
                }
            }
            return false;
        }

        // 执行移动并翻转
        function makeMove(row, col) {
            if (gameOver || !isValidMove(row, col, currentPlayer)) return;

            // 放置棋子 - 立即设置颜色并添加出现动画
            board[row][col] = currentPlayer;
            const piece = document.querySelector(`[data-row="${row}"][data-col="${col}"] .piece`);
            piece.classList.add(currentPlayer === 1 ? 'black' : 'white', 'appear');

            // 翻转棋子 - 在落子后立即开始翻转动画，并在动画中间改变颜色
            let totalToFlip = 0;
            for (let [dr, dc] of directions) {
                let toFlip = [];
                let r = row + dr;
                let c = col + dc;
                while (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_SIZE && board[r][c] === -currentPlayer) {
                    toFlip.push([r, c]);
                    r += dr;
                    c += dc;
                }
                if (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_SIZE && board[r][c] === currentPlayer) {
                    totalToFlip += toFlip.length;
                    for (let [fr, fc] of toFlip) {
                        board[fr][fc] = currentPlayer;
                        const flipPiece = document.querySelector(`[data-row="${fr}"][data-col="${fc}"] .piece`);
                        const oldColor = flipPiece.classList.contains('black') ? 'black' : 'white';
                        const newColor = currentPlayer === 1 ? 'black' : 'white';
                        
                        // 开始翻转动画
                        flipPiece.classList.add('flip');
                        
                        // 在翻转动画中间（50%，300ms）改变颜色
                        setTimeout(() => {
                            flipPiece.classList.remove(oldColor);
                            flipPiece.classList.add(newColor);
                        }, 300);
                        
                        // 动画结束后移除 flip 类
                        setTimeout(() => {
                            flipPiece.classList.remove('flip');
                        }, 600);
                    }
                }
            }

            // 切换玩家并处理回合（延迟到翻转完成后）
            setTimeout(() => {
                currentPlayer = -currentPlayer;
                nextTurn();
            }, 600);
        }

        // 处理下一回合
        function nextTurn() {
            if (gameOver) return;

            if (!hasValidMoves(currentPlayer)) {
                currentPlayer = -currentPlayer;
                if (!hasValidMoves(currentPlayer)) {
                    endGame();
                    return;
                }
            }

            renderBoard();
            highlightValidMoves();
            updateStatus();
        }

        // 结束游戏
        function endGame() {
            gameOver = true;
            let { blackCount, whiteCount } = countPieces();
            let winner = blackCount > whiteCount ? '黑方' : whiteCount > blackCount ? '白方' : '平局';
            const status = document.querySelector('.status');
            status.innerHTML = `<span class="winner">${winner} 获胜！</span> 黑: ${blackCount} 白: ${whiteCount}`;
            renderBoard();

            // 添加获胜特效：整个棋盘轻微抖动
            const boardEl = document.getElementById('board');
            boardEl.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => boardEl.style.animation = '', 500);
        }

        // 更新状态
        function updateStatus() {
            if (gameOver) return;
            const status = document.querySelector('.status');
            const playerText = currentPlayer === 1 ? '黑方' : '白方';
            status.innerHTML = `<span class="player current">${playerText}</span> 的回合`;
            
            // 更新分数显示
            const { blackCount, whiteCount } = countPieces();
            const scoresEl = document.getElementById('scores');
            scoresEl.innerHTML = `<span class="score black-score">黑: ${blackCount}</span><span class="score white-score">白: ${whiteCount}</span>`;
        }

        // 重新开始
        function resetGame() {
            initBoard();
        }

        // 初始化
        initBoard();
    </script>
</body>
</html>